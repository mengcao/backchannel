<% count = votable.count_vote(session[:user_id]) %>
<% voters = votable.voters(session[:user_id]) %>
<p>
  <% if count.sum != 0 %>
    <% if count[0] == 0 %>
      <% if votable.show_voters == true %>
          <% voters.each do |v| %>
              <% if v != voters.last %>
                  <%= v.name %>,
              <% else %>
                  <%= v.name %>
              <% end %>
          <% end %>
          voted
          <%= link_to "hide",:controller => :posts,:action =>:toggle_voters %>
      <% else %>
          <%= link_to "#{count[1]}",:controller => :posts,:action =>:toggle_voters %> people voted
      <% end %>
    <% elsif count[1] == 0%>
      you voted
    <% else %>
      you and
      <% if votable.show_voters == true %>
        <% voters.each do |v| %>
          <% if v != voters.last %>
            <%= v.name %>,
          <% else %>
            <%= v.name %>
          <% end %>
        <% end %>
        voted
        <%= link_to "hide",:controller => :posts,:action =>:toggle_voters %>
      <% else %>
        <%= link_to "#{count[1]}",:controller => :posts,:action =>:toggle_voters %> other people voted
      <% end %>
    <% end %>
  <% end %>
</p>

<p>
    <% if session[:user_id] %>
        <% if votable.user_id != session[:user_id] %>
            <% if votable.votes.where(:user_id => session[:user_id]).count == 0 %>
                <% if votable.is_a?(Post) %>
                    <%= button_to 'vote',:controller => :votes,:action => :create,:post_id => votable.id %>
                <% end %>
                <% if votable.is_a?(Comment) %>
                    <%= button_to 'vote',:controller => :votes,:action => :create,:comment_id => votable.id %>
                <% end %>
            <% end %>
            <% if votable.votes.where(:user_id => session[:user_id]).count != 0 %>
                <%= button_to 'un-vote', Vote.where(:votable_id => votable.id).where(:user_id => session[:user_id]).first,:method => :delete %>
            <% end %>
        <% end %>
    <% end %>
</p>